-- SUB QUERY ; QUERY안에 QUERY가 내포
-- 1. 서브 쿼리 개념
-- 서브쿼리 필요성 예제 : 급여를 제일 많이 받는 사람의 이름과 급여
SELECT ENAME, MAX(SAL) FROM EMP; -- 에러
SELECT ENAME, MAX(SAL) FROM EMP GROUP BY ENAME; -- 다 찍혀
SELECT MAX(SAL) FROM EMP; -- 서브쿼리
SELECT ENAME, SAL 
  FROM EMP
  WHERE SAL = (SELECT MAX(SAL) FROM EMP); -- 메인쿼리(실행할 쿼리)
-- 서브쿼리 종류(1) 단일행서브쿼리(서브쿼리결과가 단일행) = > >= != < <= ....
  -- SCOTT이 근무하는 부서이름 출력
  SELECT DEPTNO FROM EMP WHERE ENAME='SCOTT'; -- 서브쿼리
  SELECT DNAME FROM DEPT 
    WHERE DEPTNO = (SELECT DEPTNO FROM EMP WHERE ENAME='SCOTT'); -- 메인쿼리
-- 서브쿼리 종류(2) 다중행서브쿼리(서브쿼리결과가 2행이상)  IN, ANY, ALL, EXISTS
  -- JOB이 MANAGER인 사람의 부서이름
  SELECT DEPTNO FROM EMP WHERE JOB='MANAGER'; -- 서브쿼리
  SELECT DNAME FROM DEPT
    WHERE DEPTNO IN (SELECT DEPTNO FROM EMP WHERE JOB='MANAGER');
    
-- 2. 단일행 서브쿼리
-- SCOTT과 같은 부서번호인 사람의 이름과 급여
SELECT DEPTNO FROM EMP WHERE ENAME='SCOTT'; -- 서브쿼리
SELECT ENAME, SAL FROM EMP
  WHERE DEPTNO=(SELECT DEPTNO FROM EMP WHERE ENAME='SCOTT') AND
    ENAME <> 'SCOTT'; -- 메인쿼리
--SCOTT과 같은 근무지인 사람의 이름과 급여
SELECT * FROM DEPT;
INSERT INTO DEPT VALUES (50, 'IT','DALLAS');
SELECT * FROM EMP;
INSERT INTO EMP (EMPNO, ENAME, DEPTNO) 
  VALUES (9999,'홍',50);
--SCOTT과 같은 근무지인 사람의 이름과 급여 (20,50부서)
SELECT LOC FROM DEPT D, EMP E
  WHERE D.DEPTNO=E.DEPTNO AND ENAME='SCOTT'; -- 서브쿼리
SELECT ENAME, SAL
  FROM EMP E, DEPT D
  WHERE E.DEPTNO=D.DEPTNO AND
    LOC = (SELECT LOC FROM DEPT D, EMP E
          WHERE D.DEPTNO=E.DEPTNO AND ENAME='SCOTT') AND
    ENAME != 'SCOTT'; -- 메인쿼리
ROLLBACK; -- 데이터 추가 취소