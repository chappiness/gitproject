-- SCOTT과 같은 부서에 근무하는 사람들의 급여합
SELECT DEPTNO FROM EMP WHERE ENAME='SCOTT'; -- 서브쿼리
SELECT SUM(SAL) FROM EMP 
  WHERE DEPTNO = (SELECT DEPTNO FROM EMP WHERE ENAME='SCOTT'); -- 메인쿼리

-- SCOTT과 동일한 직책(JOB)을 가진 사원의 모든 필드
SELECT JOB FROM EMP WHERE ENAME='SCOTT'; -- 서브쿼리
SELECT * FROM EMP WHERE JOB=(SELECT JOB FROM EMP WHERE ENAME='SCOTT'); -- 메인쿼리

-- DALLAS 에서 근무하는 사원의 이름, 부서번호
SELECT DEPTNO FROM DEPT WHERE LOC='DALLAS'; -- 서브쿼리
SELECT ENAME, DEPTNO FROM EMP 
  WHERE DEPTNO = (SELECT DEPTNO FROM DEPT WHERE LOC='DALLAS'); -- 메인쿼리

-- SALES(DNAME) 부서에 근무하는 사원의 이름, 급여
SELECT ENAME, SAL FROM EMP
  WHERE DEPTNO = (SELECT DEPTNO FROM DEPT WHERE DNAME='SALES'); -- 메인쿼리

-- 'KING'이 직속상사인 사원의 이름과 급여
SELECT ENAME, SAL FROM EMP
  WHERE MGR=(SELECT EMPNO FROM EMP WHERE ENAME='KING');

-- ex1.평균급여 이하로 받는 사원의 이름과 급여를 출력
SELECT AVG(SAL) FROM EMP; -- 서브쿼리
SELECT ENAME, SAL FROM EMP
  WHERE SAL <= (SELECT AVG(SAL) FROM EMP); -- 메인쿼리

-- ex2. 평균급여 이하로 받는 사원의 이름과 급여, 평균급여를 출력
SELECT ENAME, SAL, (SELECT ROUND(AVG(SAL)) FROM EMP) AVG
  FROM EMP
  WHERE SAL <= (SELECT AVG(SAL) FROM EMP);

-- ex3. 평균급여 이하로 받는 사원의 이름과 급여, 평균과 차이를 출력
SELECT ENAME, SAL, ROUND(ABS((SELECT AVG(SAL) FROM EMP)-SAL),2) DIFF 
  FROM EMP
  WHERE SAL <= (SELECT AVG(SAL) FROM EMP);

-- SCOTT과 JOB과 부서번호가 같은 직원의 모든 필드 출력
SELECT JOB, DEPTNO FROM EMP WHERE ENAME='SCOTT'; -- 다중열 서브쿼리
SELECT * FROM EMP
  WHERE (JOB,DEPTNO) = (SELECT JOB, DEPTNO FROM EMP WHERE ENAME='SCOTT')
    AND ENAME<>'SCOTT';